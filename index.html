<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REFRIMAQ UBERABA</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 30px;
            margin-bottom: 30px;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        /* Estilos da logo e company-info para a TELA (visualização normal) */
        /* O .header-content-print será o flex container para a tela e para o PDF */
        .header-content-print {
            display: flex;
            flex-direction: column;
            /* Empilha logo e company-info */
            align-items: center;
            /* Centraliza horizontalmente */
            margin-top: 20px;
            /* Espaçamento da tela */
        }

        .logo {
            width: 100%;
            height: auto;
            padding-bottom: 5%;
            /* Mantido para visualização na tela */
            height: auto;
            /* Mantenha 'auto' para evitar distorção */
            display: block;
            margin: 0 15px;
            /* Centraliza a logo na tela e adiciona margem inferior */
        }

        .company-info {
            display: block;
            /* Garante que as informações da empresa fiquem em bloco */
            text-align: center;
            /* Centraliza o texto na tela */
        }

        .company-info h5 {
            margin-bottom: 5px;
        }

        .company-info p {
            margin-bottom: 2px;
        }

        .section-title {
            background-color: #e9ecef;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 1.25rem;
            font-weight: bold;
        }

        .table th,
        .table td {
            vertical-align: middle;
            padding: 8px;
        }

        /* Alteração aqui: Defina um tamanho de fonte menor para o total-geral na tela */
        .total-geral {
            font-size: 1.25rem; /* Ajustado para um tamanho mais adequado na tela */
            font-weight: bold;
            color: #007bff;
        }

        /* **** ESTILOS ESPECÍFICOS PARA O PDF (IMPRESSÃO) **** */
        @media print {
            .header {
                text-align: center !important;
                /* Garante centralização do conteúdo do header */
                margin-bottom: 0 !important;
                /* Remove margem inferior do header */
                padding-bottom: 0 !important;
                /* Remove padding inferior do header */
            }

            /* Container para a logo e informações da empresa no PDF */
            .header-content-print {
                display: flex !important;
                flex-direction: column !important;
                /* Empilha logo e company-info */
                align-items: center !important;
                /* Centraliza horizontalmente ambos */
                margin-top: 0 !important;
                /* Remove margem superior do container no PDF */
                margin-bottom: 10px !important;
                /* Espaçamento reduzido abaixo do cabeçalho completo */
                width: 100%;
                /* Ocupa a largura total para centralização */
            }

            .logo {
                width: 100%;
                /* Largura da logo no PDF */
                height: auto !important;
                /* Mantém proporção */
                margin: 0 auto 5px auto !important;
                /* Centraliza logo e reduz margem inferior para o PDF */
            }

            .company-info {
                text-align: center !important;
                /* Centraliza o texto das informações no PDF */
                margin-top: 0 !important;
                /* Remove margem superior da info da empresa */
                padding: 0 !important;
                /* Remove paddings desnecessários */
            }

            .company-info h5 {
                font-size: 1rem !important;
            }

            .company-info p {
                font-size: 0.8rem !important;
                margin-bottom: 2px !important;
            }

            /* Remover coluna "Ações" */
            .acoes-col {
                display: none !important;
            }

            #itensOrcamentoTable tbody tr td:last-child {
                display: none !important;
            }

            #itensOrcamentoTable tfoot tr td:last-child {
                display: none !important;
            }

            /* Ajustes para inputs de formulário no PDF (transforma em texto) */
            .form-control {
                border: none !important;
                background-color: transparent !important;
                padding: 0 !important;
                box-shadow: none !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
                height: auto !important;
                font-size: inherit !important;
                line-height: inherit !important;
            }

            input,
            textarea,
            select {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            .table-bordered th,
            .table-bordered td {
                border: 1px solid #dee2e6 !important;
            }

            /* Mantém o Total Geral menor e uniforme para o PDF */
            #totalGeral {
                font-size: 1.2rem !important; /* Já estava ajustado para o PDF */
                text-align: left !important;
                padding-left: 10px !important;
                color: #007bff !important;
            }

            .total-geral strong {
                font-size: 1.2rem !important; /* Já estava ajustado para o PDF */
            }

            /* Deixar o ID orcamentoContent em negrito */
            #orcamentoContent {
                font-weight: bold !important;
            }

            /* Revertendo o negrito para elementos específicos que não devem ser negrito */
            #orcamentoContent label,
            #orcamentoContent input,
            #orcamentoContent select,
            #orcamentoContent textarea,
            #orcamentoContent th,
            #orcamentoContent td,
            #orcamentoContent .total-geral,
            #orcamentoContent .section-title {
                font-weight: normal !important;
            }

            #orcamentoContent .total-geral strong {
                font-weight: bold !important;
            }

            /* Oculta os botões "Adicionar Item" e "Gerar PDF" na impressão */
            #adicionarItem,
            #gerarPdf {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="container" id="orcamentoContent">
        <div class="header">
            <div class="header-content-print">
                <img src="Logo.png" alt="Logo RefriMaq" class="logo">
                <div class="company-info">
                    <h5>Maqmoura Comércio e Serviços Ltda</h5>
                    <p class="mb-0">Rua Gabriel Junqueira, 181</p>
                    <p class="mb-0">CNPJ: 25.475.492/0001-00</p>
                    <p class="mb-0">Tel. (34) 3321-5599 Cel. (34) 9978-5599</p>
                </div>
            </div>
        </div>

        <div class="section-title">Dados do Cliente e Orçamento</div>
        <form id="orcamentoForm">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="cliente">Cliente:</label>
                    <input type="text" class="form-control" id="cliente" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="data">Data:</label>
                    <input type="date" class="form-control" id="data" value="2025-07-14" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="telefoneCliente">Telefone do Cliente:</label>
                    <input type="text" class="form-control" id="telefoneCliente">
                </div>
                <div class="form-group col-md-6">
                    <label for="emailCliente">Email do Cliente:</label>
                    <input type="email" class="form-control" id="emailCliente">
                </div>
            </div>
            <div class="form-group">
                <label for="tituloOrcamento">Título do Orçamento:</label>
                <input type="text" class="form-control" id="tituloOrcamento">
            </div>

            <div class="section-title mt-4">Itens do Orçamento</div>
            <table class="table table-bordered" id="itensOrcamentoTable">
                <thead>
                    <tr>
                        <th>Quantidade</th>
                        <th>Material</th>
                        <th>Local</th>
                        <th>Descrição</th>
                        <th>Valor </th>
                        <th>Total Item</th>
                        <th class="acoes-col">Ações</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="5" class="text-right"><strong>Total Geral:</strong></td>
                        <td id="totalGeral" class="total-geral">R$ 0,00</td>
                        <td class="acoes-col"></td>
                    </tr>
                </tfoot>
            </table>
            <button type="button" class="btn btn-success mt-3" id="adicionarItem">Adicionar Item</button>

            <div class="text-center mt-5">
                <button type="button" class="btn btn-primary btn-lg" id="gerarPdf">Gerar PDF</button>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const itensOrcamentoTableBody = document.querySelector('#itensOrcamentoTable tbody');
            const adicionarItemBtn = document.getElementById('adicionarItem');
            const totalGeralSpan = document.getElementById('totalGeral');
            const gerarPdfBtn = document.getElementById('gerarPdf');
            const dataInput = document.getElementById('data');
            let itemCount = 0;

            // Define a data atual
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Mês é 0-indexed
            const year = today.getFullYear();
            dataInput.value = `${year}-${month}-${day}`;

            // Função para adicionar uma nova linha de item
            function adicionarItem() {
                itemCount++;
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="number" class="form-control form-control-sm item-quantidade" value="1" min="1" data-id="${itemCount}"></td>
                    <td><input type="text" class="form-control form-control-sm item-material" data-id="${itemCount}"></td>
                    <td><input type="text" class="form-control form-control-sm item-local" data-id="${itemCount}"></td>
                    <td><input type="text" class="form-control form-control-sm item-descricao" data-id="${itemCount}"></td>
                    <td><input type="number" class="form-control form-control-sm item-valor-unitario" step="0.01" value="0.00" data-id="${itemCount}"></td>
                    <td><span class="item-total" data-id="${itemCount}">R$ 0,00</span></td>
                    <td><button type="button" class="btn btn-danger btn-sm remover-item" data-id="${itemCount}">Remover</button></td>
                `;
                itensOrcamentoTableBody.appendChild(newRow);
                attachEventListeners(newRow);
                calcularTotalGeral();
            }

            // Função para anexar event listeners a uma nova linha
            function attachEventListeners(row) {
                const quantidadeInput = row.querySelector('.item-quantidade');
                const valorUnitarioInput = row.querySelector('.item-valor-unitario');
                const removerBtn = row.querySelector('.remover-item');

                quantidadeInput.addEventListener('input', calcularTotalItem);
                valorUnitarioInput.addEventListener('input', calcularTotalItem);
                removerBtn.addEventListener('click', removerItem);
            }

            // Função para calcular o total de um item específico
            function calcularTotalItem(event) {
                const itemId = event.target.dataset.id;
                const quantidade = parseFloat(document.querySelector(`.item-quantidade[data-id="${itemId}"]`).value) || 0;
                const valorUnitario = parseFloat(document.querySelector(`.item-valor-unitario[data-id="${itemId}"]`).value) || 0;
                const totalItem = quantidade * valorUnitario;
                document.querySelector(`.item-total[data-id="${itemId}"]`).textContent = `R$ ${totalItem.toFixed(2).replace('.', ',')}`;
                calcularTotalGeral();
            }

            // Função para calcular o total geral
            function calcularTotalGeral() {
                let totalGeral = 0;
                document.querySelectorAll('.item-total').forEach(span => {
                    const totalTexto = span.textContent.replace('R$ ', '').replace(',', '.');
                    totalGeral += parseFloat(totalTexto) || 0;
                });
                totalGeralSpan.textContent = `R$ ${totalGeral.toFixed(2).replace('.', ',')}`;
            }

            // Função para remover um item
            function removerItem(event) {
                const itemId = event.target.dataset.id;
                const rowToRemove = event.target.closest('tr');
                rowToRemove.remove();
                calcularTotalGeral();
            }

            // Event listener para o botão "Adicionar Item"
            adicionarItemBtn.addEventListener('click', adicionarItem);

            // Adiciona o primeiro item ao carregar a página
            adicionarItem();

            // Event listener para o botão "Gerar PDF"
            gerarPdfBtn.addEventListener('click', function () {
                const element = document.getElementById('orcamentoContent'); // O elemento que queremos converter

                // Opções para o html2pdf
                const opt = {
                    margin: 10,
                    filename: 'orcamento.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                // Clona o elemento para manipular antes de gerar o PDF
                const clonedElement = element.cloneNode(true);

                // --- MANIPULAÇÕES ESPECÍFICAS PARA O PDF NO CLONE (VIA JS) ---

                // Substitui inputs por spans com seus valores para o PDF
                clonedElement.querySelectorAll('input').forEach(input => {
                    const span = document.createElement('span');
                    span.textContent = input.value;
                    span.style.display = 'inline-block';
                    // Copia estilos básicos para manter a aparência
                    span.style.padding = '0';
                    span.style.margin = '0';
                    input.parentNode.insertBefore(span, input);
                    input.remove();
                });

                // Remove a coluna de ações e os botões
                // Remove o cabeçalho 'Ações'
                const acoesHeader = clonedElement.querySelector('#itensOrcamentoTable thead .acoes-col');
                if (acoesHeader) {
                    acoesHeader.remove();
                }

                // Remove a célula 'Ações' de cada linha do corpo da tabela
                clonedElement.querySelectorAll('#itensOrcamentoTable tbody tr').forEach(row => {
                    const lastCell = row.querySelector('td:last-child');
                    if (lastCell) {
                        if (lastCell.querySelector('.remover-item') || lastCell.classList.contains('acoes-col')) {
                            lastCell.remove();
                        }
                    }
                });

                // Remove a célula 'Ações' do rodapé da tabela
                const acoesFooterCell = clonedElement.querySelector('#itensOrcamentoTable tfoot .acoes-col');
                if (acoesFooterCell) {
                    acoesFooterCell.remove();
                }

                // Ajusta o colspan do Total Geral no rodapé da tabela
                const totalGeralLabelTd = clonedElement.querySelector('#itensOrcamentoTable tfoot tr td:first-child');
                if (totalGeralLabelTd) {
                    totalGeralLabelTd.setAttribute('colspan', '4');
                }

                // Remove os botões 'Adicionar Item' e 'Gerar PDF'
                clonedElement.querySelector('#adicionarItem')?.remove();
                clonedElement.querySelector('#gerarPdf')?.remove();

                // Gera o PDF
                html2pdf().from(clonedElement).set(opt).save();
            });
        });
    </script>
</body>

</html>
